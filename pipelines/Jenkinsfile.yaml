pipeline:
  environment:
  parameters:
    - "string defaultValue: '3', description: '', name: 'USERS', trim: false"
  options:
    - disableConcurrentBuilds()
  agent:
    any:
  tools:
    maven: maven3.8.6
  stages:
    - stage: Checkout
      steps:
        - git 'https://github.com/aytuncbeken/pipeline-as-yaml-tutorials.git'
    - stage: Maven
      stages:
        - stage: Build
          steps:
            - sh 'mvn clean compile'
        - stage: Test
          steps:
            script:
              - sh "mvn clean test -Dusers=${USERS}"
         - stage: Install
          steps:
            script:
              - withCredentials: "[usernamePassword(credentialsId: '4df35022-a000-4782-baf5-0adbecbacc6b', passwordVariable: 'PASSOWRD', usernameVariable: 'USERNAME')]"
                script:
                - sh "mvn clean install -DskipTest -Dusername=${USERNAME} -Dpassword=${PASSWORD}"
              - withEnv: "['API_URL=https://api.ipify.org?format=json']"
                script:
                  - sh "curl ${API_URL}"     
        
